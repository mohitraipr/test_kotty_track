<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Delivery Challan</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    /* Reset and Base Styling */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Roboto', sans-serif;
      font-size: 11px;
      color: #333;
      line-height: 1.5;
      background-color: #f9f9f9;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border: 1px solid #ddd;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      min-height: 90vh;
    }
    /* Print Button */
    .print-btn {
      padding: 6px 12px;
      font-size: 11px;
      margin-bottom: 15px;
      cursor: pointer;
    }
    @media print {
      .print-btn {
        display: none;
      }
    }
    /* Utility Classes */
    .text-left { text-align: left; }
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    
    /* Watermark */
    .watermark {
      text-align: right;
      font-size: 9px;
      color: #aaa;
      margin-bottom: 10px;
    }
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #444;
    }
    .header h1 {
      font-size: 16px;
      text-decoration: underline;
      letter-spacing: 1px;
      color: #222;
    }
    /* Top Sender Details Section - Force one row without wrapping */
    .sender-section-top {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      flex-wrap: nowrap;
    }
    .sender-details-col {
      flex: 0 0 43%;
      margin-bottom: 0;
    }
    .sender-details-col2,
    .sender-details-col3 {
      flex: 0 0 28%;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      text-align: left;
      margin-bottom: 0;
    }
    /* Label-Value Pair for Fixed Alignment */
    .label-value {
      display: flex;
      margin-bottom: 4px;
      align-items: center;
    }
    .label-value .label {
      width: 110px;  /* Fixed width for all labels */
      font-weight: 500;
      color: #222;
      text-align: right;
      margin-right: 5px;
    }
    .label-value .value {
      flex: 1;
    }
    .company-name {
      font-weight: 700;
      font-size: 14px;
    }
    .company-address {
      font-size: 11px;
      color: #555;
      white-space: pre-line;
    }
    /* Consignee Details */
    .consignee-section table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-bottom: 15px;
    }
    .consignee-section td {
      padding: 6px;
      vertical-align: top;
    }
    .consignee-section .col-label {
      font-weight: 500;
      border-top: 1px solid #333;
      padding-bottom: 4px;
      color: #222;
    }
    /* Place of Supply */
    .supply-section {
      margin-top: 10px;
      font-size: 11px;
      padding: 6px;
      border-top: 2px solid #000;
      border-bottom: 2px solid #000;
      margin-bottom: 15px;
    }
    /* Items Table */
    .items-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 11px;
    }
    .items-table th,
    .items-table td {
      border: 1px solid #ddd;
      padding: 6px;
    }
    .items-table th {
      text-align: center;
      font-weight: 500;
      background: #e8e8e8;
    }
    .items-table td {
      vertical-align: top;
    }
    .items-table .align-left { text-align: left; }
    .items-table .align-center { text-align: center; }
    .items-table .align-right { text-align: right; }
    .items-table tr:nth-child(even) {
      background: #f9f9f9;
    }
    /* Totals Summary */
    .summary-details {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #ccc;
      text-align: right;
      line-height: 1.6;
      font-size: 11px;
    }
    .summary-details div {
      margin: 4px 0;
    }
    /* Footer */
    .footer {
      text-align: right;
      font-size: 11px;
      line-height: 1.5;
      margin-top: 15px;
    }
    .signatory {
      margin-top: 50px;
      width: 200px;
      border-top: 1px solid #333;
      text-align: center;
      padding-top: 5px;
      margin-left: auto;
    }
    /* Responsive Adjustments */
    @media screen and (max-width: 600px) {
      .sender-section-top {
        flex-wrap: wrap;
      }
      .sender-details-col,
      .sender-details-col2,
      .sender-details-col3 {
        flex: 0 0 100%;
        margin-bottom: 10px;
      }
      .items-table,
      .consignee-section table,
      .supply-section {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Print Button -->
    <button class="print-btn" onclick="window.print()">Print</button>
    <!-- Header -->
    <div class="header">
      <h1>DELIVERY CHALLAN</h1>
    </div>
    
    <!-- Top Sender Details Section -->
    <div class="sender-section-top">
      <!-- Column 1: Sender Info -->
      <div class="sender-details-col">
        <div class="sender-item">
          <div class="company-name">KOTTY LIFESTYLE<br>PRIVATE LIMITED</div>
        </div>
        <div class="sender-item">
          <div class="company-address">
            GB-65, BHARAT VIHAR,
            LAKKARPUR, FARIDABAD,
            HARYANA, Haryana 121009
          </div>
        </div>
      </div>
      
      <!-- Column 2: Sender GSTIN Details -->
      <div class="sender-details-col2">
        <div class="sender-item">
          <div class="label-value">
            <div class="label">GSTIN:</div>
            <div class="value"><%= challan.sender.gstin %></div>
          </div>
        </div>
        <div class="sender-item">
          <div class="label-value">
            <div class="label">State:</div>
            <div class="value"><%= challan.sender.state %></div>
          </div>
        </div>
        <div class="sender-item">
          <div class="label-value">
            <div class="label">PAN:</div>
            <div class="value"><%= challan.sender.pan %></div>
          </div>
        </div>
      </div>
      
      <!-- Column 3: Challan Details -->
      <div class="sender-details-col3">
        <div class="sender-item">
          <div class="label-value">
            <div class="label">Challan Date:</div>
            <div class="value"><%= challan.challanDate %></div>
          </div>
        </div>
        <div class="sender-item">
          <div class="label-value">
            <div class="label">Challan No.:</div>
            <div class="value"><%= challan.challanNo %></div>
          </div>
        </div>
        <div class="sender-item">
          <div class="label-value">
            <div class="label">Reference No.:</div>
            <div class="value"><%= challan.referenceNo ? challan.referenceNo : '-' %></div>
          </div>
        </div>
        <div class="sender-item">
          <div class="label-value">
            <div class="label">Challan Type:</div>
            <div class="value"><%= challan.challanType %></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Consignee Details -->
    <% let addrLines = challan.consignee.address.split(','); %>
    <div class="consignee-section">
      <table>
        <tr>
          <td class="col-label text-left" style="width:50%;">Consignee Name</td>
          <td class="col-label text-left" style="width:50%;">Consignee Address</td>
          
        </tr>
        <tr>
          <td class="text-left" style="vertical-align: top;">
            <%= challan.consignee.name %><br><br>
            <strong>Consignee GSTIN</strong><br>
            <%= challan.consignee.gstin %>
          </td>
          <td class="text-left" style="vertical-align: top;">
            <%= challan.consignee.name %><br>
            <%= addrLines.join(' ') %><br>
            India<br>
            <%= challan.consignee.gstin %>
            <br>
            <b>vehicleNumber: </b><%= challan.vehicleNumber %>
          </td>
        </tr>
      </table>
    </div>

    <!-- Place of Supply -->
    <div class="supply-section">
      <strong>Place of Supply:</strong> <%= challan.consignee.placeOfSupply %>
    </div>

    <!-- Items Table -->
    <table class="items-table">
      <thead>
        <tr>
          <th class="text-left">Item</th>
          <th class="text-center">HSN / SAC</th>
          <th class="text-right">Quantity</th>
          <th class="text-right">Rate / Item (₹)</th>
          <th class="text-right">Taxable Value (₹)</th>
          <th class="text-center">CGST (₹)</th>
          <th class="text-center">IGST (₹)</th>
          <th class="text-center">SGST / UTGST (₹)</th>
          <th class="text-right">CESS (₹)</th>
          <th class="text-right">Total (₹)</th>
        </tr>
      </thead>
      <tbody>
        <% challan.items.forEach((item, index) => { %>
          <tr>
            <td class="text-left">
              <%= index + 1 %>. lot no-<%= item.lot_no %>, sku-<%= item.sku %>
            </td>
            <td class="text-center">62034200</td>
            <td class="text-right">
              <%= parseFloat(item.total_pieces).toLocaleString('en-IN') %> PCS
            </td>
            <td class="text-right">200.00</td>
            <td class="text-right">
              <%= parseFloat(item.taxableValue).toLocaleString('en-IN') %>
            </td>
            <td class="text-center">0.00 @0.00%</td>
            <td class="text-center">0.00 @0.00%</td>
            <td class="text-center">0.00 @0.00%</td>
            <td class="text-right">0.00</td>
            <td class="text-right">
              <%= parseFloat(item.taxableValue).toLocaleString('en-IN') %>
            </td>
          </tr>
        <% }); %>
        <!-- Totals Row -->
        <tr>
          <td colspan="4" class="text-right" style="font-weight:bold;">Total</td>
          <!-- Column 5: Total Taxable Value -->
          <td class="text-right" style="font-weight:bold;">
            <%= parseFloat(challan.totalTaxableValue).toLocaleString('en-IN') %>
          </td>
          <!-- Column 6: CGST Total -->
          <td class="text-right">0.00</td>
          <!-- Column 7: IGST Total -->
          <td class="text-right">0.00</td>
          <!-- Column 8: SGST Total -->
          <td class="text-right">0.00</td>
          <!-- Column 9: CESS Total -->
          <td class="text-right">0.00</td>
          <!-- Column 10: Final Total Amount -->
          <td class="text-right" style="font-weight:bold;">
            <%= parseFloat(challan.totalAmount).toLocaleString('en-IN') %>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Totals Summary -->
    <div class="summary-details">
      <div><strong>Taxable Amount:</strong> ₹ <%= parseFloat(challan.totalTaxableValue).toLocaleString('en-IN') %></div>
      <div><strong>Total Tax:</strong> ₹ 0.00</div>
      <div><strong>Total Value:</strong> ₹ <%= parseFloat(challan.totalAmount).toLocaleString('en-IN') %></div>
      <div style="margin-top:10px;"><strong>Total amount:</strong><br><%= challan.totalAmountInWords %></div>
    </div>

    <!-- Footer with Signatory -->
    <div class="footer">
      For <%= challan.sender.name %>
      <div class="signatory">
        Authorised Signatory
      </div>
    </div>
  </div>
</body>
</html>
